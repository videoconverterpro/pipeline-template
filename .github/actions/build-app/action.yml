# ============================================================================
# ğŸ—ï¸ COMPOSITE ACTION REUTILIZÃVEL: Build + Artifact Upload
# ============================================================================
# 
# PROPÃ“SITO:
#   Action genÃ©rica para build de projetos Node.js e upload de artifacts:
#   - Executa script de build configurado
#   - Upload da pasta dist/ como artifact
#   100% reutilizÃ¡vel por qualquer projeto Node.js.
#
# COMO USAR:
#   steps:
#     - uses: actions/checkout@v4
#     - uses: videoconverterpro/pipeline-template/.github/actions/setup-node-pnpm@main
#     - uses: videoconverterpro/pipeline-template/.github/actions/build-app@main
#       with:
#         build-script: 'build'
#         dist-folder: 'dist'
#         artifact-retention: 7
#
# PRÃ‰-REQUISITOS:
#   - node_modules instalado (usar setup-node-pnpm antes)
#   - Script de build no package.json
#
# PROPRIEDADE:
#   Bruno Roberto Morillo - CPF: 460.876.598-11
#   Â© 2025 VideoConverterPro - Todos os direitos reservados
#
# ============================================================================

name: "ğŸ—ï¸ Build + Artifact"
description: "Build da aplicaÃ§Ã£o e upload de artifact"

inputs:
  build-script:
    description: "Nome do script de build no package.json"
    required: false
    default: "build"
  
  dist-folder:
    description: "Nome da pasta de output (dist, build, out, etc)"
    required: false
    default: "dist"
  
  artifact-retention:
    description: "Dias de retenÃ§Ã£o do artifact no GitHub"
    required: false
    default: "7"

runs:
  using: "composite"
  steps:
    # ========================================================================
    # STEP 1: Build da aplicaÃ§Ã£o
    # ========================================================================
    - name: "ğŸ—ï¸ [ACTION] Build da aplicaÃ§Ã£o"
      shell: bash
      run: |
        echo "ğŸ—ï¸ Buildando aplicaÃ§Ã£o..."
        pnpm run ${{ inputs.build-script }}
        echo "âœ… Build concluÃ­do com sucesso!"
        
        # Verificar se pasta de output existe
        if [ ! -d "${{ inputs.dist-folder }}" ]; then
          echo "âŒ Erro: Pasta '${{ inputs.dist-folder }}' nÃ£o encontrada apÃ³s build!"
          exit 1
        fi
        
        echo "ğŸ“¦ ConteÃºdo da pasta ${{ inputs.dist-folder }}:"
        ls -lah ${{ inputs.dist-folder }}
    
    # ========================================================================
    # STEP 2: Upload do artifact
    # ========================================================================
    - name: "ğŸ“¤ [ACTION] Upload artifact - ${{ inputs.dist-folder }}"
      uses: actions/upload-artifact@v4
      with:
        name: ${{ inputs.dist-folder }}-${{ github.sha }}
        path: ${{ inputs.dist-folder }}
        retention-days: ${{ inputs.artifact-retention }}
        if-no-files-found: error
