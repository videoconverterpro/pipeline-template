# ============================================================================
# üöÄ WORKFLOW REUTILIZ√ÅVEL: Pipeline Completa de Valida√ß√£o
# ============================================================================
# 
# PROP√ìSITO:
#   Workflow orquestrador que executa pipeline completa de valida√ß√£o:
#   1. Setup (Node.js + pnpm + cache)
#   2. Quality Check (Prettier + ESLint)
#   3. Build (compila√ß√£o + artifact)
#   
#   Pipeline gen√©rica para valida√ß√£o de PRs, branches de homologa√ß√£o, etc.
#   100% reutiliz√°vel por qualquer projeto Node.js.
#
# COMO USAR:
#   # No reposit√≥rio do projeto, criar .github/workflows/homolog.yml:
#   
#   name: Valida√ß√£o Homologa√ß√£o
#   on:
#     push:
#       branches: [homolog]
#     pull_request:
#       branches: [homolog]
#   
#   jobs:
#     validate:
#       uses: videoconverterpro/pipeline-template/.github/workflows/validate-pipeline.yml@main
#       with:
#         node-version: '24'
#         pnpm-version: '10'
#
# CUSTOMIZA√á√ïES:
#   - Vers√µes de Node.js e pnpm
#   - Diret√≥rio de trabalho (monorepos)
#   - Scripts customizados (build, lint, format)
#   - Reten√ß√£o de artifacts
#
# SA√çDAS:
#   - C√≥digo validado (formata√ß√£o + linting)
#   - Build compilado
#   - Artifact dispon√≠vel (7 dias)
#
# PROPRIEDADE:
#   Bruno Roberto Morillo - CPF: 460.876.598-11
#   ¬© 2025 VideoConverterPro - Todos os direitos reservados
#
# ============================================================================

name: "üöÄ Pipeline Valida√ß√£o Completa"

on:
  workflow_call:
    inputs:
      # Vers√£o do Node.js
      node-version:
        description: 'Vers√£o do Node.js'
        required: false
        type: string
        default: '24'
      
      # Vers√£o do pnpm
      pnpm-version:
        description: 'Vers√£o do pnpm'
        required: false
        type: string
        default: '10'
      
      # Diret√≥rio de trabalho
      working-directory:
        description: 'Diret√≥rio onde est√° o package.json'
        required: false
        type: string
        default: '.'
      
      # Scripts customizados
      format-script:
        description: 'Script de format check'
        required: false
        type: string
        default: 'format:check'
      
      lint-script:
        description: 'Script de lint check'
        required: false
        type: string
        default: 'lint:check'
      
      build-script:
        description: 'Script de build'
        required: false
        type: string
        default: 'build'
      
      # Configura√ß√µes de build
      dist-folder:
        description: 'Pasta de output do build'
        required: false
        type: string
        default: 'dist'
      
      artifact-retention:
        description: 'Dias de reten√ß√£o do artifact'
        required: false
        type: number
        default: 7

jobs:
  # ==========================================================================
  # JOB 1: Setup - Configurar ambiente e cache
  # ==========================================================================
  setup:
    name: "üîß Setup Ambiente"
    uses: videoconverterpro/pipeline-template/.github/workflows/setup-node-pnpm.yml@main
    with:
      node-version: ${{ inputs.node-version }}
      pnpm-version: ${{ inputs.pnpm-version }}
      working-directory: ${{ inputs.working-directory }}
  
  # ==========================================================================
  # JOB 2: Quality - Validar c√≥digo (Prettier + ESLint)
  # ==========================================================================
  quality:
    name: "‚úÖ Quality Check"
    needs: setup
    uses: videoconverterpro/pipeline-template/.github/workflows/quality-check.yml@main
    with:
      working-directory: ${{ inputs.working-directory }}
      format-script: ${{ inputs.format-script }}
      lint-script: ${{ inputs.lint-script }}
  
  # ==========================================================================
  # JOB 3: Build - Compilar e gerar artifact
  # ==========================================================================
  build:
    name: "üèóÔ∏è Build Aplica√ß√£o"
    needs: [setup, quality]
    uses: videoconverterpro/pipeline-template/.github/workflows/build-app.yml@main
    with:
      working-directory: ${{ inputs.working-directory }}
      build-script: ${{ inputs.build-script }}
      dist-folder: ${{ inputs.dist-folder }}
      artifact-retention: ${{ inputs.artifact-retention }}
  
  # ==========================================================================
  # JOB 4: Sucesso - Confirma√ß√£o final
  # ==========================================================================
  success:
    name: "üéâ Pipeline Conclu√≠da"
    needs: [setup, quality, build]
    runs-on: ubuntu-latest
    steps:
      - name: "üéâ Valida√ß√£o completa com sucesso!"
        shell: bash
        run: |
          echo "======================================"
          echo "‚úÖ PIPELINE CONCLU√çDA COM SUCESSO!"
          echo "======================================"
          echo ""
          echo "‚úÖ Setup: Node.js ${{ inputs.node-version }} + pnpm ${{ inputs.pnpm-version }}"
          echo "‚úÖ Quality: Prettier + ESLint"
          echo "‚úÖ Build: ${{ inputs.dist-folder }}/ gerado"
          echo ""
          echo "üì¶ Artifact dispon√≠vel por ${{ inputs.artifact-retention }} dias"
          echo "üöÄ Pronto para deploy!"
