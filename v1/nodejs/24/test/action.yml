name: Testes da AplicaÃ§Ã£o
description: Executa testes unitÃ¡rios, integraÃ§Ã£o e e2e (genÃ©rico para qualquer framework Node.js)

inputs:
  unit:
    description: 'Executar testes unitÃ¡rios (pnpm test)'
    required: false
    default: 'true'
  integration:
    description: 'Executar testes de integraÃ§Ã£o (pnpm test:integration)'
    required: false
    default: 'false'
  e2e:
    description: 'Executar testes e2e (pnpm test:e2e)'
    required: false
    default: 'false'
  coverage:
    description: 'Gerar relatÃ³rio de cobertura (pnpm test:cov)'
    required: false
    default: 'false'

runs:
  using: composite
  steps:
    - name: "[ACTION] Test - UnitÃ¡rios"
      if: inputs.unit == 'true'
      shell: bash
      run: |
        if grep -q '"test":' package.json; then
          echo "ğŸ§ª Executando testes unitÃ¡rios..."
          pnpm test
        else
          echo "âš ï¸  Script 'test' nÃ£o encontrado no package.json"
        fi

    - name: "[ACTION] Test - IntegraÃ§Ã£o"
      if: inputs.integration == 'true'
      shell: bash
      run: |
        if grep -q '"test:integration":' package.json; then
          echo "ğŸ”— Executando testes de integraÃ§Ã£o..."
          pnpm test:integration
        else
          echo "âš ï¸  Script 'test:integration' nÃ£o encontrado no package.json"
        fi

    - name: "[ACTION] Test - E2E"
      if: inputs.e2e == 'true'
      shell: bash
      run: |
        if grep -q '"test:e2e":' package.json; then
          echo "ğŸŒ Executando testes e2e..."
          pnpm test:e2e
        else
          echo "âš ï¸  Script 'test:e2e' nÃ£o encontrado no package.json"
        fi

    - name: "[ACTION] Test - Coverage"
      if: inputs.coverage == 'true'
      shell: bash
      run: |
        if grep -q '"test:cov":' package.json; then
          echo "ğŸ“Š Gerando relatÃ³rio de cobertura..."
          pnpm test:cov
        else
          echo "âš ï¸  Script 'test:cov' nÃ£o encontrado no package.json"
        fi

    - name: "[ACTION] Artifact - Upload coverage"
      if: inputs.coverage == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: coverage-${{ github.sha }}
        path: coverage/
        retention-days: 7
        if-no-files-found: ignore
