name: Build NestJS com Prisma
description: Executa build completo de aplica√ß√£o NestJS com Prisma Client

runs:
  using: composite
  steps:
    - name: "[ACTION] Prisma - Gerar Client"
      shell: bash
      run: |
        if [ -f "prisma/schema.prisma" ]; then
          echo "üì¶ Gerando Prisma Client..."
          pnpm prisma generate
        else
          echo "‚ö†Ô∏è  Prisma schema n√£o encontrado, pulando gera√ß√£o"
        fi

    - name: "[ACTION] Build - Compilar aplica√ß√£o NestJS"
      shell: bash
      run: pnpm build

    - name: "[ACTION] Verificar - Arquivos gerados"
      shell: bash
      run: |
        if [ ! -d "dist" ]; then
          echo "‚ùå Erro: Pasta dist/ n√£o foi gerada!"
          exit 1
        fi
        if [ ! -f "dist/main.js" ]; then
          echo "‚ùå Erro: main.js n√£o encontrado em dist/!"
          exit 1
        fi
        echo "‚úÖ Build NestJS conclu√≠do com sucesso!"
        echo "üìä Arquivos gerados:"
        ls -lh dist/

    - name: "[ACTION] Artifact - Upload dist/"
      uses: actions/upload-artifact@v4
      with:
        name: nestjs-dist-${{ github.sha }}
        path: dist/
        retention-days: 7
