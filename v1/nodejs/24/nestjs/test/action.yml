name: Testes NestJS
description: Executa testes unit치rios e e2e de aplica칞칚o NestJS

inputs:
  run-e2e:
    description: 'Executar testes e2e (requer banco de dados)'
    required: false
    default: 'false'
  coverage:
    description: 'Gerar relat칩rio de cobertura'
    required: false
    default: 'false'

runs:
  using: composite
  steps:
    - name: "[ACTION] Test - Testes unit치rios"
      shell: bash
      run: |
        echo "游빍 Executando testes unit치rios..."
        if [ "${{ inputs.coverage }}" == "true" ]; then
          pnpm test:cov
        else
          pnpm test
        fi

    - name: "[ACTION] Test E2E - Testes de integra칞칚o"
      if: inputs.run-e2e == 'true'
      shell: bash
      run: |
        echo "游댧 Executando testes e2e..."
        pnpm test:e2e

    - name: "[ACTION] Coverage - Upload relat칩rio"
      if: inputs.coverage == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: coverage-report-${{ github.sha }}
        path: coverage/
        retention-days: 30
